tinymce.PluginManager.add('fullpreview', function(e) {
    // 获取浏览器高宽
    function getWH() {
        var body = document.body;
        var w = window;
        var width, height;
        (body.offsetWidth) && ( width = body.offsetWidth, heigth = body.offsetHeight);
        (w.innerWidth) && (w.innerHeight) && ( width = w.innerWidth, height = w.innerHeight);
        return {
            w: width,
            h: height
        }
    }
    // 触发浏览器全屏事件
    function launchFullscreen (element) {
        if(element.requestFullscreen) {
            element.requestFullscreen();
        } else if(element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
        } else if(element.webkitRequestFullscreen) {
            element.webkitRequestFullscreen();
        } else if(element.msRequestFullscreen) {
            element.msRequestFullscreen();
        }
    }
    function handleClick() {
        var node = document.getElementById('tinymceContent_ifr');
        var DOM = tinymce.DOM;
        var editorDOM = tinymce.activeEditor.dom;
        if (node) {
            // 修改 指针样式.并且将 HTML, body 的高度设置为 100%
            DOM.setStyle(editorDOM.getRoot(), 'cursor', 'url("./cursor.png"), auto');
            DOM.setStyle(editorDOM.getRoot(), 'height', '100%');
            DOM.setStyle(editorDOM.doc.getElementsByTagName('html')[0], 'height', '100%');
            tinymce.activeEditor.setMode('readonly');
            launchFullscreen(node);
            $(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){
                var fullscreenEnabled = document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement;
                var DOM = tinymce.DOM;
                var editorDOM = tinymce.activeEditor.dom;
                if (!fullscreenEnabled) {
                    DOM.setStyle(editorDOM.getRoot(), 'cursor', '');
                    DOM.setStyle(editorDOM.getRoot(), 'height', '');
                    DOM.setStyle(editorDOM.doc.getElementsByTagName('html')[0], 'height', '');
                    tinymce.activeEditor.setMode('design');
                    tinymce.activeEditor.focus()
                }
            });
        }
    }
    e.addButton('fullpreview', {
        text: '预览',
        onClick: handleClick
    });
})